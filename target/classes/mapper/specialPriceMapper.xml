<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/schema/mybatis-3-mapper.dtd">

<mapper namespace="com.hanssem.app.dao.specialPriceMapper">

    <resultMap id="specialProductMain" type="SpecialPriceDto">
        <result column="special_product_number" property="special_product_number"/>
        <result column="special_product_end_date" property="special_product_end_date"/>
        <result column="special_product_discount" property="special_product_discount"/>
        <result column="special_product_discount" property="special_product_discount"/>
        <result column="review_count" property="review_count"/>
        <result column="review_rank_average" property="review_rank_average"/>
        <collection property="productDto" resultMap="ProductDto"/>
    </resultMap>

    <resultMap id="ProductDto" type="ProductDto">
        <result column="product_number" property="product_number"/>
        <result column="product_name" property="product_name"/>
        <result column="product_price" property="product_price"/>
        <result column="product_content" property="product_content"/>
        <result column="product_register_date" property="product_register_date"/>
        <result column="product_status" property="product_status"/>
        <result column="product_class" property="product_class"/>
        <result column="category_code_number" property="category_code_number"/>
    </resultMap>

    <select id="selectSpecialProduct" resultMap="SpecialPriceDto" parameterType="int">
        select *, (SELECT sum(review_rank)/count(*) FROM review r WHERE r.product_number = p.product_number) review_rank_average, (SELECT COUNT(*) FROM review r WHERE r.product_number = p.product_number) review_count from special_product sp, product p WHERE p.product_number = sp.product_number and p.product_status=#{product_number};
    </select>

</mapper>